jobs:
  include:
  - os: windows
    language: shell
    before_install:
    - choco install python3 --params "/InstallDir:C:\python3"
    - /c/Python3/python -m venv $HOME/venv
    - source $HOME/venv/Scripts/activate
    - python -m pip install --upgrade pip
    env: CMAKE_GENERATOR="Visual Studio 15 2017 Win64"
  - os: linux
    language: python
    python: "3"
    deploy:
      provider: pypi
      user: "__token__"
      password: "$PYPI_TOKEN"
      distributions: "sdist"
      skip_existing: true
      on:
        branch: master
  - os: linux
    language: python
    python: "3"
    env: LCMS_THREADS=4
branches:
  only:
  - master
  - develop
install:
- pip install -r build-requirements.txt
- python setup.py install
script:
- pip install -r requirements.txt
- pytest tests
